\>{\tiny 1}\'\>\texttt{\textbf{from}}~synch~\texttt{\textbf{import}}~*\\

\>{\tiny 2}\'\>\\

\>{\tiny 3}\'\>\texttt{\textbf{def}}~Barrier(\textit{limit}):\\

\>{\tiny 4}\'\>~~~~\textit{result}~=~\{\\

\>{\tiny 5}\'\>~~~~~~~~~~~~.limit:~limit,\\

\>{\tiny 6}\'\>~~~~~~~~~~~~.mutex:~\textit{Lock}(),\\

\>{\tiny 7}\'\>~~~~~~~~~~~~.full:~\textit{Condition}(),~.others:~\textit{Condition}(),\\

\>{\tiny 8}\'\>~~~~~~~~~~~~.entered:~0,~.left:~limit\\

\>{\tiny 9}\'\>~~~~~~~~\}\\

\>{\tiny 10}\'\>\\

\>{\tiny 11}\'\>\texttt{\textbf{def}}~enter(\textit{b}):\\

\>{\tiny 12}\'\>~~~~acquire(?\textit{b}$\rightarrow$mutex)\\

\>{\tiny 13}\'\>~~~~\texttt{\textbf{while}}~\textit{b}$\rightarrow$entered~==~\textit{b}$\rightarrow$limit:\\

\>{\tiny 14}\'\>~~~~~~~~wait(?\textit{b}$\rightarrow$full,~?\textit{b}$\rightarrow$mutex)\\

\>{\tiny 15}\'\>~~~~\textit{b}$\rightarrow$entered~+=~1\\

\>{\tiny 16}\'\>~~~~\texttt{\textbf{if}}~\textit{b}$\rightarrow$entered~==~\textit{b}$\rightarrow$limit:\\

\>{\tiny 17}\'\>~~~~~~~~\textit{b}$\rightarrow$left~=~0\\

\>{\tiny 18}\'\>~~~~~~~~notifyAll(?\textit{b}$\rightarrow$others)\\

\>{\tiny 19}\'\>~~~~\texttt{\textbf{else}}:\\

\>{\tiny 20}\'\>~~~~~~~~\texttt{\textbf{while}}~\textit{b}$\rightarrow$entered~$<$~\textit{b}$\rightarrow$limit:\\

\>{\tiny 21}\'\>~~~~~~~~~~~~wait(?\textit{b}$\rightarrow$others,~?\textit{b}$\rightarrow$mutex)\\

\>{\tiny 22}\'\>~~~~release(?\textit{b}$\rightarrow$mutex)\\

\>{\tiny 23}\'\>\\

\>{\tiny 24}\'\>\texttt{\textbf{def}}~exit(\textit{b}):\\

\>{\tiny 25}\'\>~~~~acquire(?\textit{b}$\rightarrow$mutex)\\

\>{\tiny 26}\'\>~~~~\textit{b}$\rightarrow$left~+=~1\\

\>{\tiny 27}\'\>~~~~\texttt{\textbf{if}}~\textit{b}$\rightarrow$left~==~\textit{b}$\rightarrow$limit:\\

\>{\tiny 28}\'\>~~~~~~~~\textit{b}$\rightarrow$entered~=~0\\

\>{\tiny 29}\'\>~~~~~~~~notifyAll(?\textit{b}$\rightarrow$full)\\

\>{\tiny 30}\'\>~~~~release(?\textit{b}$\rightarrow$mutex)