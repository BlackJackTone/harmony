from synch import *;

const N = 5;

forks = [Lock(),] * N;
sema = Semaphore(N - 1);

def diner(which):
    let left, right = (which - 1, which % N):
        while choose({ False, True }):
            P(?sema);
            acquire(?forks[left]);
            acquire(?forks[right]);
            # dine
            release(?forks[left]);
            release(?forks[right]);
            V(?sema);
            # think
        ;
    ;
;

for i in {1..N}:
    spawn diner(i);
;
