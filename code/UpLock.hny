from synch import Lock, acquire, release

count = 0
countlock = Lock()
done = [ False, False ]

def thread(self):
    acquire(?countlock)
    count = count + 1
    release(?countlock)
    done[self] = True

def main(self):
    await all(done)
    assert count == 2

spawn thread(0)
spawn thread(1)
spawn main()
