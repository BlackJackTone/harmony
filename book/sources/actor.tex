\>{\tiny 1}\'\>\texttt{\textbf{import}}~synch\\

\>{\tiny 2}\'\>\\

\>{\tiny 3}\'\>\texttt{\textbf{def}}~pc\_actor(\textit{q},~\textit{nrequests}):\\

\>{\tiny 4}\'\>~~~~\texttt{\textbf{let}}~\textit{requests},~\textit{balance}~=~\{\},~0:\\

\>{\tiny 5}\'\>~~~~~~~~\texttt{\textbf{while}}~\textit{nrequests}~$>$~0:\\

\>{\tiny 6}\'\>~~~~~~~~~~~~\texttt{\textbf{let}}~\textit{req}~=~synch.get(\textit{q}):\\

\>{\tiny 7}\'\>~~~~~~~~~~~~~~~~\texttt{\textbf{if}}~\textit{req}.type~==~.produce:\\

\>{\tiny 8}\'\>~~~~~~~~~~~~~~~~~~~~\texttt{\textbf{if}}~\textit{balance}~$>=$~0:\\

\>{\tiny 9}\'\>~~~~~~~~~~~~~~~~~~~~~~~~\textit{requests}~$\vert$=~\{~\textit{req}~\}\\

\>{\tiny 10}\'\>~~~~~~~~~~~~~~~~~~~~\texttt{\textbf{else}}:\\

\>{\tiny 11}\'\>~~~~~~~~~~~~~~~~~~~~~~~~\texttt{\textbf{let}}~\textit{r}~=~\texttt{\textbf{choose}}(\textit{requests}):\\

\>{\tiny 12}\'\>~~~~~~~~~~~~~~~~~~~~~~~~~~~~\texttt{\textbf{assert}}~\textit{r}.type~==~.consume\\

\>{\tiny 13}\'\>~~~~~~~~~~~~~~~~~~~~~~~~~~~~synch.put(\textit{r}.queue,~\textit{req}.item)\\

\>{\tiny 14}\'\>~~~~~~~~~~~~~~~~~~~~~~~~~~~~\textit{requests}~--=~\{~\textit{r}~\}\\

\>{\tiny 15}\'\>~~~~~~~~~~~~~~~~~~~~\textit{balance}~+=~1\\

\>{\tiny 16}\'\>~~~~~~~~~~~~~~~~\texttt{\textbf{else}}:\\

\>{\tiny 17}\'\>~~~~~~~~~~~~~~~~~~~~\texttt{\textbf{assert}}~\textit{req}.type~==~.consume\\

\>{\tiny 18}\'\>~~~~~~~~~~~~~~~~~~~~\texttt{\textbf{if}}~\textit{balance}~$<=$~0:\\

\>{\tiny 19}\'\>~~~~~~~~~~~~~~~~~~~~~~~~\textit{requests}~$\vert$=~\{~\textit{req}~\}\\

\>{\tiny 20}\'\>~~~~~~~~~~~~~~~~~~~~\texttt{\textbf{else}}:\\

\>{\tiny 21}\'\>~~~~~~~~~~~~~~~~~~~~~~~~\texttt{\textbf{let}}~\textit{r}~=~\texttt{\textbf{choose}}(\textit{requests}):\\

\>{\tiny 22}\'\>~~~~~~~~~~~~~~~~~~~~~~~~~~~~\texttt{\textbf{assert}}~\textit{r}.type~==~.produce\\

\>{\tiny 23}\'\>~~~~~~~~~~~~~~~~~~~~~~~~~~~~synch.put(\textit{req}.queue,~\textit{r}.item)\\

\>{\tiny 24}\'\>~~~~~~~~~~~~~~~~~~~~~~~~~~~~\textit{requests}~--=~\{~\textit{r}~\}\\

\>{\tiny 25}\'\>~~~~~~~~~~~~~~~~~~~~\textit{balance}~--=~1\\

\>{\tiny 26}\'\>~~~~~~~~~~~~\textit{nrequests}~--=~1\\

\>{\tiny 27}\'\>\\

\>{\tiny 28}\'\>\texttt{\textbf{def}}~init(\textit{q},~\textit{n}):\\

\>{\tiny 29}\'\>~~~~\texttt{\textbf{spawn}}~pc\_actor(\textit{q},~\textit{n})