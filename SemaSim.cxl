def P(sema):
    var blocked = True;
    while blocked:
        atomic:
            if ^sema > 0:
                ^sema := ^sema - 1;
                blocked := False;
            .
        .
    .
.
def V(sema):
    atomic:
        ^sema := ^sema + 1;
    .
.
def p():
    while True:
        call P&(mysema);
        @cs:    # critical section
        call V&(mysema);
    .
.
mysema := 1;
spawn p(), 0;
spawn p(), 1;
spawn p(), 2;
spawn p(), 3;
