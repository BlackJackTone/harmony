import synch;

countlock = Lock();
count = 0;
done = False;

def handler():
    lock(?countlock);
      count += 1;
    unlock(?countlock);
    done = True;
;
def main():
    trap handler();
    lock(?countlock);
      count += 1;
    unlock(?countlock);
    await done;
    assert count == 2;
;

spawn main();
