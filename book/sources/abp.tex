\>{\tiny 1}\'\>\textit{s\_chan}~=~\textit{r\_chan}~=~()\\

\>{\tiny 2}\'\>\textit{s\_seq}~=~\textit{r\_seq}~=~0\\

\>{\tiny 3}\'\>\\

\>{\tiny 4}\'\>\texttt{\textbf{def}}~net\_send(\textit{pchan},~\textit{m},~\textit{reliable}):\\

\>{\tiny 5}\'\>~~~~!\textit{pchan}~=~\textit{m}~\texttt{\textbf{if}}~(\textit{reliable}~\texttt{\textbf{or}}~\texttt{\textbf{choose}}(\{~\texttt{\textbf{False}},~\texttt{\textbf{True}}~\}))~\texttt{\textbf{else}}~()\\

\>{\tiny 6}\'\>\\

\>{\tiny 7}\'\>\texttt{\textbf{def}}~net\_recv(\textit{pchan}):\\

\>{\tiny 8}\'\>~~~~\textit{result}~=~!\textit{pchan}\\

\>{\tiny 9}\'\>\\

\>{\tiny 10}\'\>\texttt{\textbf{def}}~app\_send(\textit{payload}):\\

\>{\tiny 11}\'\>~~~~\textit{s\_seq}~=~1~--~\textit{s\_seq}\\

\>{\tiny 12}\'\>~~~~\texttt{\textbf{let}}~\textit{m},~\textit{blocked}~=~\{~.seq:~\textit{s\_seq},~.payload:~payload~\},~\texttt{\textbf{True}}:\\

\>{\tiny 13}\'\>~~~~~~~~\texttt{\textbf{while}}~\textit{blocked}:\\

\>{\tiny 14}\'\>~~~~~~~~~~~~net\_send(?\textit{s\_chan},~\textit{m},~\texttt{\textbf{False}})\\

\>{\tiny 15}\'\>~~~~~~~~~~~~\texttt{\textbf{let}}~\textit{response}~=~net\_recv(?\textit{r\_chan}):\\

\>{\tiny 16}\'\>~~~~~~~~~~~~~~~~\textit{blocked}~=~(\textit{response}~==~())~\texttt{\textbf{or}}~(\textit{response}.ack~!=~\textit{s\_seq})\\

\>{\tiny 17}\'\>~~~~~~~~~~~~\\

\>{\tiny 18}\'\>\texttt{\textbf{def}}~app\_recv(\textit{reliable}):\\

\>{\tiny 19}\'\>~~~~\textit{r\_seq}~=~1~--~\textit{r\_seq}\\

\>{\tiny 20}\'\>~~~~\texttt{\textbf{let}}~\textit{blocked}~=~\texttt{\textbf{True}}:\\

\>{\tiny 21}\'\>~~~~~~~~\texttt{\textbf{while}}~\textit{blocked}:\\

\>{\tiny 22}\'\>~~~~~~~~~~~~\texttt{\textbf{let}}~\textit{m}~=~net\_recv(?\textit{s\_chan}):\\

\>{\tiny 23}\'\>~~~~~~~~~~~~~~~~\texttt{\textbf{if}}~\textit{m}~!=~():\\

\>{\tiny 24}\'\>~~~~~~~~~~~~~~~~~~~~net\_send(?\textit{r\_chan},~\{~.ack:~\textit{m}.seq~\},~\textit{reliable})\\

\>{\tiny 25}\'\>~~~~~~~~~~~~~~~~~~~~\texttt{\textbf{if}}~\textit{m}.seq~==~\textit{r\_seq}:\\

\>{\tiny 26}\'\>~~~~~~~~~~~~~~~~~~~~~~~~\textit{result}~=~\textit{m}.payload\\

\>{\tiny 27}\'\>~~~~~~~~~~~~~~~~~~~~~~~~\textit{blocked}~=~\texttt{\textbf{False}}