def p():
    while True:
        while True: end while
        @cs: skip    # critical section
    end while
end def

flags := dict{ 0: False, 1: False };
spawn p(), 0;
spawn p(), 1;
