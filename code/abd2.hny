import abd1

def reader():
    let first = abd1.read((.reader, 1))
    let second = abd1.read((.reader, 2)):
        assert (first == .token) => (second == .token)

def writer():
    abd1.write((.writer, 1), .token)

for i in { 1 .. abd1.NSERVERS }:
    spawn eternal abd1.server()
spawn reader()
spawn writer()
