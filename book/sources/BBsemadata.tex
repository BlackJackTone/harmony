\>{\tiny 1}\'\>\texttt{\textbf{import}}~BBsema;\\

\>{\tiny 2}\'\>\\

\>{\tiny 3}\'\>\texttt{\textbf{const}}~NPRODS~=~2;~~~~~~~\emph{\# number of producers}\\

\>{\tiny 4}\'\>\texttt{\textbf{const}}~NCONSS~=~NPRODS;~~\emph{\# number of consumers}\\

\>{\tiny 5}\'\>\\

\>{\tiny 6}\'\>\texttt{\textbf{def}}~producer(\textit{i}):\\

\>{\tiny 7}\'\>~~~~\textit{produce}((\textit{i},~0));\\

\>{\tiny 8}\'\>~~~~\textit{produce}((\textit{i},~1));\\

\>{\tiny 9}\'\>;\\

\>{\tiny 10}\'\>\texttt{\textbf{def}}~consumer():\\

\>{\tiny 11}\'\>~~~~\texttt{\textbf{let}}~\textit{first}~=~\textit{consume}()~\texttt{\textbf{let}}~\textit{second}~=~\textit{consume}():\\

\>{\tiny 12}\'\>~~~~~~~~\texttt{\textbf{assert}}~(\textit{first}[0]~!=~\textit{second}[0])~\texttt{\textbf{or}}~(\textit{first}[1]~$<$~\textit{second}[1]);\\

\>{\tiny 13}\'\>~~~~~~~~\texttt{\textbf{atomic}}:\\

\>{\tiny 14}\'\>~~~~~~~~~~~~\textit{received}~$\vert$=~\{~\textit{first},~\textit{second}~\};\\

\>{\tiny 15}\'\>~~~~~~~~;\\

\>{\tiny 16}\'\>~~~~;\\

\>{\tiny 17}\'\>;\\

\>{\tiny 18}\'\>\texttt{\textbf{def}}~main():\\

\>{\tiny 19}\'\>~~~~\texttt{\textbf{await}}~\texttt{\textbf{len}}(\textit{received})~==~(2~*~NCONSS);\\

\>{\tiny 20}\'\>~~~~\texttt{\textbf{assert}}~\textit{received}~==~(\{~(\textit{i},~0)~\texttt{\textbf{for}}~\textit{i}~\texttt{\textbf{in}}~\{1..NPRODS\}~\}~$\vert$\\

\>{\tiny 21}\'\>~~~~~~~~~~~~~~~~~~~~~~~~~~~~\{~(\textit{i},~1)~\texttt{\textbf{for}}~\textit{i}~\texttt{\textbf{in}}~\{1..NPRODS\}~\})\\

\>{\tiny 22}\'\>~~~~;\\

\>{\tiny 23}\'\>;\\

\>{\tiny 24}\'\>\textit{received}~=~\{\};\\

\>{\tiny 25}\'\>\texttt{\textbf{for}}~\textit{i}~\texttt{\textbf{in}}~\{1..NPRODS\}:\\

\>{\tiny 26}\'\>~~~~\texttt{\textbf{spawn}}~producer(\textit{i});\\

\>{\tiny 27}\'\>;\\

\>{\tiny 28}\'\>\texttt{\textbf{for}}~\textit{i}~\texttt{\textbf{in}}~\{1..NCONSS\}:\\

\>{\tiny 29}\'\>~~~~\texttt{\textbf{spawn}}~consumer();\\

\>{\tiny 30}\'\>;\\

\>{\tiny 31}\'\>\texttt{\textbf{spawn}}~main();