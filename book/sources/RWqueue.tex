\>{\tiny 1}\'\>\texttt{\textbf{import}}~synch;\\

\>{\tiny 2}\'\>\texttt{\textbf{import}}~list;\\

\>{\tiny 3}\'\>\\

\>{\tiny 4}\'\>\texttt{\textbf{def}}~V\_one():\\

\>{\tiny 5}\'\>~~~~\texttt{\textbf{if}}~\textit{queue}~==~[~]:\\

\>{\tiny 6}\'\>~~~~~~~~V(?\textit{mutex});\\

\>{\tiny 7}\'\>~~~~\texttt{\textbf{else}}:\\

\>{\tiny 8}\'\>~~~~~~~~\texttt{\textbf{let}}~\textit{h}~=~\textit{head}(\textit{queue}):\\

\>{\tiny 9}\'\>~~~~~~~~~~~~\texttt{\textbf{if}}~(\textit{h}[0]~==~.read)~\texttt{\textbf{and}}~(\textit{w\_entered}~==~0):~V(\textit{h}[1]);\\

\>{\tiny 10}\'\>~~~~~~~~~~~~\texttt{\textbf{elif}}~(\textit{h}[0]~==~.write)~\texttt{\textbf{and}}~((\textit{r\_entered}~+~\textit{w\_entered})~==~0):~V(\textit{h}[1]);\\

\>{\tiny 11}\'\>~~~~~~~~~~~~\texttt{\textbf{else}}:~V(?\textit{mutex});\\

\>{\tiny 12}\'\>~~~~~~~~~~~~;\\

\>{\tiny 13}\'\>~~~~~~~~;\\

\>{\tiny 14}\'\>~~~~;\\

\>{\tiny 15}\'\>;\\

\>{\tiny 16}\'\>\texttt{\textbf{def}}~acquire\_rlock(\textit{psema}):\\

\>{\tiny 17}\'\>~~~~P(?\textit{mutex});\\

\>{\tiny 18}\'\>~~~~\texttt{\textbf{if}}~(\textit{w\_entered}~$>$~0)~\texttt{\textbf{or}}~(\textit{queue}~!=~[~]):\\

\>{\tiny 19}\'\>~~~~~~~~\textit{queue}~=~\textit{append}(\textit{queue},~(.read,~\textit{psema}));~V(?\textit{mutex});\\

\>{\tiny 20}\'\>~~~~~~~~P(\textit{psema});~\textit{queue}~=~\textit{tail}(\textit{queue});\\

\>{\tiny 21}\'\>~~~~;\\

\>{\tiny 22}\'\>~~~~\textit{r\_entered}~+=~1;\\

\>{\tiny 23}\'\>~~~~V\_one();\\

\>{\tiny 24}\'\>;\\

\>{\tiny 25}\'\>\texttt{\textbf{def}}~release\_rlock():\\

\>{\tiny 26}\'\>~~~~P(?\textit{mutex});~\textit{r\_entered}~--=~1;~V\_one();\\

\>{\tiny 27}\'\>;\\

\>{\tiny 28}\'\>\texttt{\textbf{def}}~acquire\_wlock(\textit{psema}):\\

\>{\tiny 29}\'\>~~~~P(?\textit{mutex});\\

\>{\tiny 30}\'\>~~~~\texttt{\textbf{if}}~(\textit{r\_entered}~+~\textit{w\_entered})~$>$~0:\\

\>{\tiny 31}\'\>~~~~~~~~\textit{queue}~=~\textit{append}(\textit{queue},~(.write,~\textit{psema}));~V(?\textit{mutex});\\

\>{\tiny 32}\'\>~~~~~~~~P(\textit{psema});~\textit{queue}~=~\textit{tail}(\textit{queue});\\

\>{\tiny 33}\'\>~~~~;\\

\>{\tiny 34}\'\>~~~~\textit{w\_entered}~=~1;\\

\>{\tiny 35}\'\>~~~~V\_one();\\

\>{\tiny 36}\'\>;\\

\>{\tiny 37}\'\>\texttt{\textbf{def}}~release\_wlock():\\

\>{\tiny 38}\'\>~~~~P(?\textit{mutex});~\textit{w\_entered}~=~0;~V\_one();\\

\>{\tiny 39}\'\>;\\

\>{\tiny 40}\'\>\textit{mutex}~=~\textit{Semaphore}(1);\\

\>{\tiny 41}\'\>\textit{r\_entered},~\textit{w\_entered}~=~0,~0;\\

\>{\tiny 42}\'\>\textit{queue}~=~[~];