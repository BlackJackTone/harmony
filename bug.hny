from synch import *

sequential w

thelock = Lock()
thecond = Condition()
x = 0

def f():
    acquire(?thelock)
    while x == 0:
        wait(?thecond, ?thelock)
    assert x == 1
    x = 2
    release(?thelock)

def g():
    acquire(?thelock)
    x = 1
    notify(?thecond)
    release(?thelock)

spawn eternal f()
spawn g()

finally x == 2
