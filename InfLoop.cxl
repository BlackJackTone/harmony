routine p:
    while True:
        while self == 1: end while
        @cs: skip // critical section
    end while
end routine

flags := {< 0: False, 1: False >};
spawn p, 0;
spawn p, 1;
