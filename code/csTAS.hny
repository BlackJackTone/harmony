lock = False;

def tas(s):
    atomic:
        result = !s;
        !s = True;
    ;
;
def process():
    while choose({ False, True }):
        await not tas(?lock);
        @cs: assert atLabel.cs == dict{ nametag(): 1 };
        lock = False;
    ;
;

for i in {1..10}:
    spawn process();
;
