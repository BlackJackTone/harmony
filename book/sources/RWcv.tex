\>{\tiny 1}\'\>\texttt{\textbf{from}}~synch~\texttt{\textbf{import}}~*\\

\>{\tiny 2}\'\>\\

\>{\tiny 3}\'\>\texttt{\textbf{def}}~RWlock():\\

\>{\tiny 4}\'\>~~~~\textit{result}~=~\{\\

\>{\tiny 5}\'\>~~~~~~~~~~~~.nreaders:~0,~.nwriters:~0,~.mutex:~\textit{Lock}(),\\

\>{\tiny 6}\'\>~~~~~~~~~~~~.r\_cond:~\textit{Condition}(),~.w\_cond:~\textit{Condition}()\\

\>{\tiny 7}\'\>~~~~~~~~\}\\

\>{\tiny 8}\'\>~~~~\\

\>{\tiny 9}\'\>\texttt{\textbf{def}}~read\_acquire(\textit{rw}):\\

\>{\tiny 10}\'\>~~~~acquire(?\textit{rw}$\rightarrow$mutex)\\

\>{\tiny 11}\'\>~~~~\texttt{\textbf{while}}~\textit{rw}$\rightarrow$nwriters~$>$~0:\\

\>{\tiny 12}\'\>~~~~~~~~wait(?\textit{rw}$\rightarrow$r\_cond,~?\textit{rw}$\rightarrow$mutex)\\

\>{\tiny 13}\'\>~~~~\textit{rw}$\rightarrow$nreaders~+=~1\\

\>{\tiny 14}\'\>~~~~release(?\textit{rw}$\rightarrow$mutex)\\

\>{\tiny 15}\'\>\\

\>{\tiny 16}\'\>\texttt{\textbf{def}}~read\_release(\textit{rw}):\\

\>{\tiny 17}\'\>~~~~acquire(?\textit{rw}$\rightarrow$mutex)\\

\>{\tiny 18}\'\>~~~~\textit{rw}$\rightarrow$nreaders~--=~1\\

\>{\tiny 19}\'\>~~~~\texttt{\textbf{if}}~\textit{rw}$\rightarrow$nreaders~==~0:\\

\>{\tiny 20}\'\>~~~~~~~~notify(?\textit{rw}$\rightarrow$w\_cond)\\

\>{\tiny 21}\'\>~~~~release(?\textit{rw}$\rightarrow$mutex)\\

\>{\tiny 22}\'\>\\

\>{\tiny 23}\'\>\texttt{\textbf{def}}~write\_acquire(\textit{rw}):\\

\>{\tiny 24}\'\>~~~~acquire(?\textit{rw}$\rightarrow$mutex)\\

\>{\tiny 25}\'\>~~~~\texttt{\textbf{while}}~(\textit{rw}$\rightarrow$nreaders~+~\textit{rw}$\rightarrow$nwriters)~$>$~0:\\

\>{\tiny 26}\'\>~~~~~~~~wait(?\textit{rw}$\rightarrow$w\_cond,~?\textit{rw}$\rightarrow$mutex)\\

\>{\tiny 27}\'\>~~~~\textit{rw}$\rightarrow$nwriters~=~1\\

\>{\tiny 28}\'\>~~~~release(?\textit{rw}$\rightarrow$mutex)\\

\>{\tiny 29}\'\>\\

\>{\tiny 30}\'\>\texttt{\textbf{def}}~write\_release(\textit{rw}):\\

\>{\tiny 31}\'\>~~~~acquire(?\textit{rw}$\rightarrow$mutex)\\

\>{\tiny 32}\'\>~~~~\textit{rw}$\rightarrow$nwriters~=~0\\

\>{\tiny 33}\'\>~~~~notifyAll(?\textit{rw}$\rightarrow$r\_cond)\\

\>{\tiny 34}\'\>~~~~notify(?\textit{rw}$\rightarrow$w\_cond)\\

\>{\tiny 35}\'\>~~~~release(?\textit{rw}$\rightarrow$mutex)