\>{\tiny 1}\'\>\textit{flags}~=~[~\texttt{\textbf{False}},~\texttt{\textbf{False}}~]\\

\>{\tiny 2}\'\>\textit{turn}~=~\texttt{\textbf{choose}}(\{0,~1\})\\

\>{\tiny 3}\'\>\\

\>{\tiny 4}\'\>\texttt{\textbf{def}}~thread(\textit{self}):\\

\>{\tiny 5}\'\>~~~~\texttt{\textbf{while}}~\texttt{\textbf{choose}}(\{~\texttt{\textbf{False}},~\texttt{\textbf{True}}~\}):\\

\>{\tiny 6}\'\>~~~~~~~~\emph{\# Enter critical section}\\

\>{\tiny 7}\'\>~~~~~~~~\textit{flags}[\textit{self}]~=~\texttt{\textbf{True}}\\

\>{\tiny 8}\'\>~~~~~~~~@gate:~\textit{turn}~=~1~--~\textit{self}\\

\>{\tiny 9}\'\>~~~~~~~~\texttt{\textbf{await}}~(\texttt{\textbf{not}}~\textit{flags}[1~--~\textit{self}])~\texttt{\textbf{or}}~(\textit{turn}~==~\textit{self})\\

\>{\tiny 10}\'\>\\

\>{\tiny 11}\'\>~~~~~~~~\emph{\# Critical section}\\

\>{\tiny 12}\'\>~~~~~~~~@cs:~\texttt{\textbf{assert}}~(\texttt{\textbf{not}}~\textit{flags}[1~--~\textit{self}])~\texttt{\textbf{or}}~(\textit{turn}~==~\textit{self})~\texttt{\textbf{or}}\\

\>{\tiny 13}\'\>~~~~~~~~~~~~~~~~~~~~(\texttt{\textbf{atLabel}}(gate)~==~\{(thread,~1~--~\textit{self}):~1\})\\

\>{\tiny 14}\'\>\\

\>{\tiny 15}\'\>~~~~~~~~\emph{\# Leave critical section}\\

\>{\tiny 16}\'\>~~~~~~~~\textit{flags}[\textit{self}]~=~\texttt{\textbf{False}}\\

\>{\tiny 17}\'\>\\

\>{\tiny 18}\'\>\texttt{\textbf{spawn}}~thread(0)\\

\>{\tiny 19}\'\>\texttt{\textbf{spawn}}~thread(1)