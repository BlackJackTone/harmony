\>{\tiny 1}\'\>\texttt{\textbf{from}}~synch~\texttt{\textbf{import}}~Lock,~acquire,~release\\

\>{\tiny 2}\'\>\\

\>{\tiny 3}\'\>\texttt{\textbf{def}}~RWlock():\\

\>{\tiny 4}\'\>~~~~\textit{result}~=~\{~.lock:~Lock(),~.nreaders:~0,~.nwriters:~0~\}\\

\>{\tiny 5}\'\>\\

\>{\tiny 6}\'\>\texttt{\textbf{def}}~read\_acquire(\textit{rw}):\\

\>{\tiny 7}\'\>~~~~acquire(?\textit{rw}$\rightarrow$lock)\\

\>{\tiny 8}\'\>~~~~\texttt{\textbf{while}}~\textit{rw}$\rightarrow$nwriters~$>$~0:\\

\>{\tiny 9}\'\>~~~~~~~~release(?\textit{rw}$\rightarrow$lock)\\

\>{\tiny 10}\'\>~~~~~~~~acquire(?\textit{rw}$\rightarrow$lock)\\

\>{\tiny 11}\'\>~~~~\textit{rw}$\rightarrow$nreaders~+=~1\\

\>{\tiny 12}\'\>~~~~release(?\textit{rw}$\rightarrow$lock)\\

\>{\tiny 13}\'\>\\

\>{\tiny 14}\'\>\texttt{\textbf{def}}~read\_release(\textit{rw}):\\

\>{\tiny 15}\'\>~~~~acquire(?\textit{rw}$\rightarrow$lock)\\

\>{\tiny 16}\'\>~~~~\textit{rw}$\rightarrow$nreaders~--=~1\\

\>{\tiny 17}\'\>~~~~release(?\textit{rw}$\rightarrow$lock)\\

\>{\tiny 18}\'\>\\

\>{\tiny 19}\'\>\texttt{\textbf{def}}~write\_acquire(\textit{rw}):\\

\>{\tiny 20}\'\>~~~~acquire(?\textit{rw}$\rightarrow$lock)\\

\>{\tiny 21}\'\>~~~~\texttt{\textbf{while}}~(\textit{rw}$\rightarrow$nreaders~+~\textit{rw}$\rightarrow$nwriters)~$>$~0:\\

\>{\tiny 22}\'\>~~~~~~~~release(?\textit{rw}$\rightarrow$lock)\\

\>{\tiny 23}\'\>~~~~~~~~acquire(?\textit{rw}$\rightarrow$lock)\\

\>{\tiny 24}\'\>~~~~\textit{rw}$\rightarrow$nwriters~=~1\\

\>{\tiny 25}\'\>~~~~release(?\textit{rw}$\rightarrow$lock)\\

\>{\tiny 26}\'\>\\

\>{\tiny 27}\'\>\texttt{\textbf{def}}~write\_release(\textit{rw}):\\

\>{\tiny 28}\'\>~~~~acquire(?\textit{rw}$\rightarrow$lock)\\

\>{\tiny 29}\'\>~~~~\textit{rw}$\rightarrow$nwriters~=~0\\

\>{\tiny 30}\'\>~~~~release(?\textit{rw}$\rightarrow$lock)