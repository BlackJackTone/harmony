import synch

const NTHREADS = 5

lock = synch.Lock()

def thread():
    synch.acquire(?lock)
    @cs: assert countLabel(cs) == 1
    synch.release(?lock)

for i in {1..NTHREADS}:
    spawn thread()
