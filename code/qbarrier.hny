from synch import Queue, put, get

const N = 3        # number of threads
const R = 4        # number of rounds

round = [0,] * N
q = [Queue(),] * N

def thread(self):
    for r in {1..R}:
        for i in {0..N-1} where i != self:
            put(?q[i], None)
        for i in {0..N-1} where i != self:
            get(?q[self])
        round[self] += 1
        assert (max(round) - min(round)) <= 1

for i in {0..N-1}:
    spawn thread(i)
