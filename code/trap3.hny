import synch;

def handler():
    lock(?countlock);
      count += 1;
    unlock(?countlock);
    done = True;
;
def main():
    trap handler();
    lock(?countlock);
      count += 1;
    unlock(?countlock);
    while not done:
        pass;
    ;
    assert count == 2;
;
countlock = Lock();
count = 0;
done = False;
spawn main();
