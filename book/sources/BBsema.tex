\>{\tiny 1}\'\>\texttt{\textbf{import}}~synch;\\

\>{\tiny 2}\'\>\\

\>{\tiny 3}\'\>\texttt{\textbf{const}}~NSLOTS~=~2;~~~~~\emph{\# size of bounded buffer}\\

\>{\tiny 4}\'\>\\

\>{\tiny 5}\'\>\texttt{\textbf{def}}~produce(\textit{item}):\\

\>{\tiny 6}\'\>~~~~P(?\textit{n\_empty});\\

\>{\tiny 7}\'\>~~~~P(?\textit{l\_in});\\

\>{\tiny 8}\'\>~~~~\textit{buf}[\textit{b\_in}]~=~\textit{item};\\

\>{\tiny 9}\'\>~~~~\textit{b\_in}~=~(\textit{b\_in}~\%~NSLOTS)~+~1;\\

\>{\tiny 10}\'\>~~~~V(?\textit{l\_in});\\

\>{\tiny 11}\'\>~~~~V(?\textit{n\_full});\\

\>{\tiny 12}\'\>;\\

\>{\tiny 13}\'\>\texttt{\textbf{def}}~consume():\\

\>{\tiny 14}\'\>~~~~P(?\textit{n\_full});\\

\>{\tiny 15}\'\>~~~~P(?\textit{l\_out});\\

\>{\tiny 16}\'\>~~~~\textit{result}~=~\textit{buf}[\textit{b\_out}];\\

\>{\tiny 17}\'\>~~~~\textit{b\_out}~=~(\textit{b\_out}~\%~NSLOTS)~+~1;\\

\>{\tiny 18}\'\>~~~~V(?\textit{l\_out});\\

\>{\tiny 19}\'\>~~~~V(?\textit{n\_empty});\\

\>{\tiny 20}\'\>;\\

\>{\tiny 21}\'\>\textit{buf}~=~\{~\textit{x}:()~\texttt{\textbf{for}}~\textit{x}~\texttt{\textbf{in}}~\{1..NSLOTS\}~\};\\

\>{\tiny 22}\'\>\textit{b\_in}~=~1;\\

\>{\tiny 23}\'\>\textit{b\_out}~=~1;\\

\>{\tiny 24}\'\>\textit{l\_in}~=~\textit{Semaphore}(1);\\

\>{\tiny 25}\'\>\textit{l\_out}~=~\textit{Semaphore}(1);\\

\>{\tiny 26}\'\>\textit{n\_full}~=~\textit{Semaphore}(0);\\

\>{\tiny 27}\'\>\textit{n\_empty}~=~\textit{Semaphore}(NSLOTS);