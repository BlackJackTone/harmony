\>{\tiny 1}\'\>\texttt{\textbf{def}}~Condition(\textit{lk}):\\

\>{\tiny 2}\'\>~~~~\textit{result}~=~\texttt{\textbf{bag}}.empty()\\

\>{\tiny 3}\'\>\\

\>{\tiny 4}\'\>\texttt{\textbf{def}}~wait(\textit{c},~\textit{lk}):\\

\>{\tiny 5}\'\>~~~~\texttt{\textbf{let}}~\textit{blocked},~\textit{cnt},~\textit{ctx}~=~\texttt{\textbf{True}},~0,~\textit{get\_context}():\\

\>{\tiny 6}\'\>~~~~~~~~\texttt{\textbf{atomic}}:\\

\>{\tiny 7}\'\>~~~~~~~~~~~~\textit{cnt}~=~\texttt{\textbf{bag}}.count(!\textit{c},~\textit{ctx})\\

\>{\tiny 8}\'\>~~~~~~~~~~~~\texttt{\textbf{bag}}.add(\textit{c},~\textit{ctx})\\

\>{\tiny 9}\'\>~~~~~~~~~~~~!\textit{lk}~=~\texttt{\textbf{False}}\\

\>{\tiny 10}\'\>~~~~~~~~\texttt{\textbf{while}}~\textit{blocked}:\\

\>{\tiny 11}\'\>~~~~~~~~~~~~\texttt{\textbf{atomic}}:\\

\>{\tiny 12}\'\>~~~~~~~~~~~~~~~~\texttt{\textbf{if}}~(\texttt{\textbf{not}}~!\textit{lk})~\texttt{\textbf{and}}~(\texttt{\textbf{bag}}.count(!\textit{c},~\textit{ctx})~$<=$~\textit{cnt}):\\

\>{\tiny 13}\'\>~~~~~~~~~~~~~~~~~~~~!\textit{lk}~=~\texttt{\textbf{True}}\\

\>{\tiny 14}\'\>~~~~~~~~~~~~~~~~~~~~\textit{blocked}~=~\texttt{\textbf{False}}\\

\>{\tiny 15}\'\>\\

\>{\tiny 16}\'\>\texttt{\textbf{def}}~notify(\textit{c}):\\

\>{\tiny 17}\'\>~~~~\texttt{\textbf{atomic}}:\\

\>{\tiny 18}\'\>~~~~~~~~\texttt{\textbf{if}}~!\textit{c}~!=~\texttt{\textbf{bag}}.empty():\\

\>{\tiny 19}\'\>~~~~~~~~~~~~\texttt{\textbf{bag}}.remove(\textit{c},~\texttt{\textbf{bag}}.bchoose(!\textit{c}))\\

\>{\tiny 20}\'\>~~~~~~~~\\

\>{\tiny 21}\'\>\texttt{\textbf{def}}~notifyAll(\textit{c}):\\

\>{\tiny 22}\'\>~~~~!\textit{c}~=~\texttt{\textbf{bag}}.empty()