\>{\tiny 1}\'\>\texttt{\textbf{from}}~synch~\texttt{\textbf{import}}~Lock,~acquire,~release\\

\>{\tiny 2}\'\>\texttt{\textbf{from}}~alloc~\texttt{\textbf{import}}~malloc,~free\\

\>{\tiny 3}\'\>\\

\>{\tiny 4}\'\>\texttt{\textbf{def}}~Queue():\\

\>{\tiny 5}\'\>~~~~\texttt{\textbf{let}}~\textit{dummy}~=~malloc(\{~.value:~(),~.next:~\texttt{\textbf{None}}~\}):\\

\>{\tiny 6}\'\>~~~~~~~~\textit{result}~=~\{~.head:~\textit{dummy},~.tail:~\textit{dummy},~.hdlock:~Lock(),~.tllock:~Lock()~\}\\

\>{\tiny 7}\'\>\\

\>{\tiny 8}\'\>\texttt{\textbf{def}}~put(\textit{q},~\textit{v}):\\

\>{\tiny 9}\'\>~~~~\texttt{\textbf{let}}~\textit{node}~=~malloc(\{~.value:~\textit{v},~.next:~\texttt{\textbf{None}}~\}):\\

\>{\tiny 10}\'\>~~~~~~~~acquire(?\textit{q}$\rightarrow$tllock)\\

\>{\tiny 11}\'\>~~~~~~~~\textit{q}$\rightarrow$tail$\rightarrow$next~=~\textit{node}\\

\>{\tiny 12}\'\>~~~~~~~~\textit{q}$\rightarrow$tail~=~\textit{node}\\

\>{\tiny 13}\'\>~~~~~~~~release(?\textit{q}$\rightarrow$tllock)\\

\>{\tiny 14}\'\>\\

\>{\tiny 15}\'\>\texttt{\textbf{def}}~get(\textit{q}):\\

\>{\tiny 16}\'\>~~~~acquire(?\textit{q}$\rightarrow$hdlock)\\

\>{\tiny 17}\'\>~~~~\texttt{\textbf{let}}~\textit{dummy}~=~\textit{q}$\rightarrow$head\\

\>{\tiny 18}\'\>~~~~\texttt{\textbf{let}}~\textit{node}~=~\textit{dummy}$\rightarrow$next:\\

\>{\tiny 19}\'\>~~~~~~~~\texttt{\textbf{if}}~\textit{node}~==~\texttt{\textbf{None}}:\\

\>{\tiny 20}\'\>~~~~~~~~~~~~\textit{result}~=~\texttt{\textbf{None}}\\

\>{\tiny 21}\'\>~~~~~~~~\texttt{\textbf{else}}:\\

\>{\tiny 22}\'\>~~~~~~~~~~~~free(\textit{dummy})\\

\>{\tiny 23}\'\>~~~~~~~~~~~~\textit{result}~=~\textit{node}$\rightarrow$value\\

\>{\tiny 24}\'\>~~~~~~~~~~~~\textit{q}$\rightarrow$head~=~\textit{node}\\

\>{\tiny 25}\'\>~~~~release(?\textit{q}$\rightarrow$hdlock)