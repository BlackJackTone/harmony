def tas(self):
    atomic:
        var oldval = ^self;
        ^self := True;
        self := oldval;
    ;
;
def p():
    while True:
        while tas&(mylock):
            pass;
        ;
        @cs:    # critical section
        mylock := False;
    ;
;
mylock := False;
spawn p(), 0;
spawn p(), 1;
