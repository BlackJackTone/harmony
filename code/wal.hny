from alloc import malloc

const BITS_PER_BLOCK = 16

def new(n_blocks) returns wal:
    wal = malloc([ None, ] * n_blocks)

def getsize(wal) returns size:
    atomically size = len !wal

def read(wal, bno) returns block:
    atomically block = (!wal)[bno]

def write(wal, bno, block):
    atomically (!wal)[bno] = block

def txbegin(wal, id):
    pass

def txend(wal, id):
    pass
